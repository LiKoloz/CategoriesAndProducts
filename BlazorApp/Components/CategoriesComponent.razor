@inject HttpClient httpClient
@inject CategoryService categoryService

@foreach (var category in Categories)
{
    <TreeItem Category="@category" />
}

<CategoryChangeComponent/>

@code {
    protected override async  Task OnInitializedAsync() =>  await LoadData();


    async private void CategoryChangeEvent()
    {
        Categories = categoryService.GetData();
        StateHasChanged();
    }

    async Task  LoadData()
    {
        categoryService.ChangeEvent += CategoryChangeEvent;
        
        Categories = await httpClient.GetFromJsonAsync<List<Category>>("/api/categories");
    }
    protected override void OnParametersSet()
    {
        categoryService.SetData(Categories);
        Categories.RemoveAll(c => c.ParentId.HasValue);
        
    }

    
    List<Category> Categories = new List<Category>()
    { }; 
}
