@using BlazorApp.Services;
 @inject HttpClient httpClient
@inject CategoryService categoryService

@foreach (var category in Categories)
{
    <TreeItem Category="@category" />
}

<CategoryChangeComponent/>

@code {
    protected override async  Task OnInitializedAsync() =>  await LoadData();


    async private void CategoryChangeEvent()
    {
        Categories = categoryService.GetData();
        StateHasChanged();
    }

    async Task  LoadData()
    {
        categoryService.ChangeEvent += CategoryChangeEvent;

        Categories = new List<Category>()
        { new Category()
        {
            Id = 0, Title = "Электронника", Children = new List<Category>(){ new Category()
        {
            Id = 0, Title = "Чайник"} }
        }, new Category()
        {
            Id = 0, Title = "Товары для дачи", Children = new List<Category>(){ new Category()
        {
            Id = 0, Title = "Гномик"} }
        }};
        //await httpClient.GetFromJsonAsync<List<Category>>("/api/categories");
    }
    protected override void OnParametersSet()
    {
        categoryService.SetData(Categories);
        Categories.RemoveAll(c => c.ParentId.HasValue);
        
    }

    
    List<Category> Categories = new List<Category>()
    { }; 
}
